generator client {
  provider            = "prisma-client-js"
  output              = "generated/prisma"
  importFileExtension = "ts"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
}

enum UserType {
  CITIZEN
  EMPLOYEE
  ADMIN
}

enum Gender {
  MASC
  FEM
}

model User {
  id        String    @id @default(nanoid())
  email     String    @unique
  password  String
  type      UserType  @default(CITIZEN)
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  updatedAt DateTime  @updatedAt()
  citizen   Citizen?
  employee  Employee?
}

model Citizen {
  id             String       @id @default(nanoid())
  userId         String       @unique
  personalInfoId String       @unique
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now())
  deletedAt      DateTime?
  updatedAt      DateTime     @updatedAt()
  personalInfo   personalInfo @relation(fields: [personalInfoId], references: [id])
  complaints     Complaint[]
  ratings        Rating[]
}

model Employee {
  id                 String              @id @default(nanoid())
  userId             String              @unique
  personalInfoId     String              @unique
  createdAt          DateTime            @default(now())
  deletedAt          DateTime?
  updatedAt          DateTime            @updatedAt()
  comments           Comment[]
  complaintEmployees ComplaintEmployee[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  personalInfo       personalInfo        @relation(fields: [personalInfoId], references: [id], onDelete: Cascade)
}

model personalInfo {
  id        String    @id @default(nanoid())
  firstName String
  lastName  String
  phone     String
  idNumber  String    @unique
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  updatedAt DateTime  @updatedAt()
  employee  Employee?
  citizen   Citizen?
}

model Complaint {
  id          String              @id @default(nanoid())
  citizenId   String
  categoryId  String
  addressId   String              @unique
  title       String
  description String
  status      ComplaintStatus     @default(PENDING)
  priority    ComplaintPriority?
  createdAt   DateTime            @default(now())
  deletedAt   DateTime?
  updatedAt   DateTime            @updatedAt()
  address     ComplaintAddress    @relation(fields: [addressId], references: [id], onDelete: Cascade)
  citizen     Citizen             @relation(fields: [citizenId], references: [id])
  category    Category            @relation(fields: [categoryId], references: [id])
  ratings     Rating[]
  comments    Comment[]
  team        ComplaintEmployee[]
}

model ComplaintEmployee {
  id          String    @id @default(nanoid())
  complaintId String
  employeeId  String
  createdAt   DateTime  @default(now())
  deletedAt   DateTime?
  updatedAt   DateTime  @updatedAt()
  complaint   Complaint @relation(fields: [complaintId], references: [id])
  employee    Employee  @relation(fields: [employeeId], references: [id])

  @@unique([complaintId, employeeId])
}

model ComplaintAddress {
  id           String     @id @default(nanoid())
  district     String
  province     String
  neighborhood String?
  latitude     Float
  longitude    Float
  createdAt    DateTime   @default(now())
  deletedAt    DateTime?
  updatedAt    DateTime   @updatedAt()
  complaint    Complaint?
}

model Rating {
  id          String    @id @default(nanoid())
  complaintId String
  citizenId   String
  rating      Float
  comment     String?
  createdAt   DateTime  @default(now())
  deletedAt   DateTime?
  updatedAt   DateTime  @updatedAt()
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  citizen     Citizen   @relation(fields: [citizenId], references: [id])
}

model Comment {
  id          String    @id @default(nanoid())
  employeeId  String
  complaintId String
  isVisible   Boolean   @default(true)
  text        String
  createdAt   DateTime  @default(now())
  deletedAt   DateTime?
  updatedAt   DateTime  @updatedAt()
  employee    Employee  @relation(fields: [employeeId], references: [id])
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
}

model Category {
  id          String      @id @default(nanoid())
  title       String      @unique
  description String
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  deletedAt   DateTime?
  updatedAt   DateTime    @updatedAt()
  complaints  Complaint[]
}
